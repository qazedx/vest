<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>

<head>
  <title>TODO supply a title</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--jq-->
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <!--bs-->
  <link href="lib/bs/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="bower_components/chartist/dist/chartist.min.css">
  <script src="lib/bs/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="bower_components/chartist/dist/chartist.min.js"></script>
  <!-- // <script type="text/javascript" src="data/data0.json"></script> -->
  <!--<link href="style.css" rel="stylesheet" type="text/css"/>-->
</head>

<body>
  <div class="container">
    <div class="ct-chart ct-perfect-fourth"></div>
    <input type="TEXT" id="user" size="40" placeholder="test post">
    <input type="button" id="submit" value="Submit">
  </div>

  <!-- <div class="ct-chart ct-golden-section" id="chart2"></div> -->
  <script>
    $(document).ready(function() {
      var user, pass;
      $("#submit").click(function() {
        user = $("#user").val();
        pass = $("#password").val();
        $.post("/", {
          user: user,
          password: pass
        }, function(data) {
          if (data === 'done') {
            alert("login success");
          }
        });
      });
    });
    var domain = document.domain;
    // var ws = new WebSocket('ws://' + domain + ':8770/');
    var host = location.origin.replace(/^http/, 'ws')
    var ws = new WebSocket(host);
    ws.open = function(event) {
      // ws.send('something');
    };

    ws.onmessage = function(event) {
      var data = {
        labels: [],
        series: [
          [],[],[],[],[]
        ]
      };
      // console.log(event.data);
      message = JSON.parse(event.data);
      for (var i = 0; i < message.items.length; i++) {
        // message[i]
        data.labels.push(message.items[i].ti);
        data.series[0].push(message.items[i].t1);
        data.series[1].push(message.items[i].t2);
        data.series[2].push(message.items[i].t3);
        data.series[3].push(message.items[i].t4);
        data.series[4].push(message.items[i].t5);
      }

      // }
      console.log(message);
      console.log(data);
      console.log(message.items[2].t1);
      draw(data);
    };
    ws.onclose = function(event) {
      console.log('err');
      setTimeout(function() {
        location.reload();
      }, 100);
    };
    //ws end


    // Create a new line chart object where as first parameter we pass in a selector
    // that is resolving to our chart container element. The Second parameter
    // is the actual data object.
    function draw(data) {
      new Chartist.Line('.ct-chart', data);
      //  Chartist.scale( 5, 16);
    }
    // new Chartist.Line('.ct-chart', data);
  </script>
</body>

</html>
